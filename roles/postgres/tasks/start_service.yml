## Set the correct service name for each OS
- name: Set PostgreSQL service name (Debian)
  set_fact:
    postgres_service: "postgresql"
  when: ansible_facts['os_family'] == 'Debian'

- name: Set PostgreSQL service name (RedHat)
  set_fact:
    postgres_service: "postgresql-{{ postgres_version }}"
  when: ansible_facts['os_family'] == 'RedHat'


- name: Start PostgreSQL service
  service:
    name: "{{ postgres_service }}"
    state: started
    enabled: yes
  when: not ansible_check_mode

- name: Check PostgreSQL service status
  shell: systemctl is-active {{ postgres_service }} || echo "inactive"
  register: postgres_status
  changed_when: false
  failed_when: false
  when: not ansible_check_mode

- name: Display PostgreSQL status
  debug:
    msg: |
      {% if ansible_check_mode %}
      [CHECK MODE] Would start PostgreSQL service: {{ postgres_service }}
      {% else %}
      PostgreSQL service status: {{ postgres_status.stdout | default('unknown') }}
      {% endif %}